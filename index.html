<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Decision Discussion Tracker</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.9/babel.min.js"></script>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:-apple-system,'Segoe UI','Noto Sans SC',sans-serif;background:#fafaf9;color:#1a1a1a}
input,select,textarea,button{font-family:inherit}
::-webkit-scrollbar{width:5px}
::-webkit-scrollbar-thumb{background:#ddd;border-radius:3px}
</style>
</head>
<body>
<div id="root"></div>
<script type="text/babel">
const {useState,useMemo}=React;
const MEMBERS=["Alice Chen","Bob Wang","Carol Li","David Zhou","Eva Liu"];
const STATUSES=["è®¨è®ºä¸­","æ‰§è¡Œä¸­","å·²å®Œæˆ"];
const PRIORITIES=["é‡è¦ä¸”ç´§æ€¥","é‡è¦ä¸ç´§æ€¥","ä¸é‡è¦ä½†ç´§æ€¥","ä¸é‡è¦ä¸ç´§æ€¥"];
const TODAY=new Date().toISOString().slice(0,10);
const PM={"é‡è¦ä¸”ç´§æ€¥":{c:"#cf1322",b:"rgba(207,19,34,0.08)"},"é‡è¦ä¸ç´§æ€¥":{c:"#d46b08",b:"rgba(212,107,8,0.07)"},"ä¸é‡è¦ä½†ç´§æ€¥":{c:"#096dd9",b:"rgba(9,109,217,0.07)"},"ä¸é‡è¦ä¸ç´§æ€¥":{c:"#8c8c8c",b:"rgba(140,140,140,0.06)"}};
const SM={"è®¨è®ºä¸­":{c:"#d46b08",b:"rgba(212,107,8,0.07)",i:"â—Œ"},"æ‰§è¡Œä¸­":{c:"#096dd9",b:"rgba(9,109,217,0.07)",i:"â–¸"},"å·²å®Œæˆ":{c:"#389e0d",b:"rgba(56,158,13,0.07)",i:"âœ“"}};

const INIT=[
  {id:1,topic:"æ–°å…´å¸‚åœºæ•å£æ˜¯å¦éœ€è¦å‡ä»“è‡³10%ä»¥ä¸‹",conclusion:"åˆ†ä¸¤æ‰¹å‡ä»“è‡³8%ï¼Œä¿ç•™5%åº•ä»“ã€‚ç¬¬ä¸€æ‰¹å·²å®Œæˆï¼Œå½“å‰æ•å£11.2%ã€‚",limitingFactor:"å°¾ç›˜æµåŠ¨æ€§ä¸è¶³ï¼Œå¤§é¢å‡ä»“éœ€åˆ†æ‰¹æ‰§è¡Œï¼ŒTWAPç®—æ³•å¾…ä¸Šçº¿ã€‚",priority:"é‡è¦ä¸”ç´§æ€¥",status:"æ‰§è¡Œä¸­",progress:65,owner:"Alice Chen",participants:["Bob Wang","Carol Li"],nextReview:"2026-02-14",createdAt:"2026-01-10",deadline:"2026-02-28",
    todos:[{id:1,text:"é€šçŸ¥äº¤æ˜“å°å‡†å¤‡å‡ä»“æŒ‡ä»¤",done:true},{id:2,text:"ç¡®è®¤æµåŠ¨æ€§çª—å£",done:true},{id:3,text:"æ‰§è¡Œç¬¬äºŒæ‰¹å‡ä»“",done:false},{id:4,text:"æ›´æ–°æŒä»“æŠ¥å‘Š",done:false}],
    notes:[{id:1,date:"2026-01-10",author:"Alice Chen",content:"æ–°å…´å¸‚åœºæ³¢åŠ¨ç‡çªç ´90%åˆ†ä½ï¼Œå»ºè®®è®¨è®ºæ˜¯å¦å‡ä»“ã€‚å½“å‰æ•å£15%ã€‚",type:"normal"},{id:2,date:"2026-01-12",author:"Bob Wang",content:"åŒæ„å‡ä»“æ–¹å‘ï¼Œä½†å»ºè®®åˆ†æ‰¹æ‰§è¡Œï¼Œé¿å…å†²å‡»æˆæœ¬ã€‚ç›®æ ‡10%ä»¥ä¸‹ã€‚",type:"normal"},{id:3,date:"2026-01-15",author:"Carol Li",content:"ä¼°å€¼å·²å¤„ä½ä½ï¼Œå®Œå…¨é€€å‡ºå¯èƒ½é”™è¿‡åå¼¹ã€‚å»ºè®®ä¿ç•™5%åº•ä»“ã€‚",type:"normal"},{id:4,date:"2026-01-18",author:"Alice Chen",content:"å›¢é˜Ÿä¸€è‡´åŒæ„ï¼šåˆ†ä¸¤æ‰¹å‡ä»“è‡³8%ï¼Œä¿ç•™åº•ä»“ã€‚ç¬¬ä¸€æ‰¹æœ¬å‘¨æ‰§è¡Œã€‚",type:"decision"},{id:5,date:"2026-01-25",author:"Bob Wang",content:"ç¬¬ä¸€æ‰¹å‡ä»“å®Œæˆï¼Œå½“å‰æ•å£11.2%ã€‚å¸‚åœºç»§ç»­ä¸‹è¡Œï¼ŒéªŒè¯äº†å‡ä»“åˆ¤æ–­ã€‚",type:"update"}]},
  {id:2,topic:"å›ºæ”¶ä¹…æœŸç­–ç•¥ï¼šæ˜¯å¦å»¶é•¿è‡³3.5å¹´",conclusion:"æŠ˜ä¸­æ–¹æ¡ˆï¼šç›®æ ‡ä¹…æœŸ3.2ï¼Œåˆ†æ­¥è°ƒæ•´ã€‚å…ˆåˆ°2.8è§‚å¯Ÿä¸€å‘¨ã€‚",limitingFactor:"åˆé€‚ä¹…æœŸçš„å“ç§ä¾›ç»™æœ‰é™ï¼Œéœ€ç­‰å¾…ä¸€çº§å¸‚åœºå‘è¡Œçª—å£ã€‚",priority:"é‡è¦ä¸ç´§æ€¥",status:"æ‰§è¡Œä¸­",progress:40,owner:"Bob Wang",participants:["Alice Chen","David Zhou"],nextReview:"2026-02-20",createdAt:"2026-01-20",deadline:"2026-03-15",
    todos:[{id:1,text:"ç­›é€‰åˆé€‚çš„é•¿ä¹…æœŸå“ç§",done:false},{id:2,text:"è®¡ç®—ç»„åˆä¹…æœŸå½±å“æµ‹ç®—",done:true}],
    notes:[{id:1,date:"2026-01-20",author:"Bob Wang",content:"åˆ©ç‡è§é¡¶ä¿¡å·å¢å¼ºï¼Œå»ºè®®å°†ç»„åˆä¹…æœŸä»2.1å»¶é•¿è‡³3.5ã€‚é¢„è®¡å¯æå‡æ”¶ç›Š50bpsã€‚",type:"normal"},{id:2,date:"2026-01-22",author:"David Zhou",content:"3.5æ¿€è¿›äº†ï¼Œé€šèƒ€éŸ§æ€§ä»åœ¨ã€‚å»ºè®®æŠ˜ä¸­åˆ°3.0ï¼Œç•™æœ‰ä½™åœ°ã€‚",type:"normal"},{id:3,date:"2026-01-28",author:"Bob Wang",content:"æŠ˜ä¸­æ–¹æ¡ˆï¼šç›®æ ‡ä¹…æœŸ3.2ï¼Œåˆ†æ­¥è°ƒæ•´ã€‚å…ˆåˆ°2.8è§‚å¯Ÿä¸€å‘¨å†å†³å®šåç»­ã€‚",type:"decision"}]},
  {id:3,topic:"ç§‘æŠ€æ¿å—é›†ä¸­åº¦è¶…é™å¤„ç†æ–¹æ¡ˆ",conclusion:"",limitingFactor:"æœŸæƒå¯¹å†²æˆæœ¬è¾ƒé«˜ï¼ˆçº¦0.8%ï¼‰ï¼Œç›´æ¥å‡ä»“å¯èƒ½é€ æˆä»·æ ¼å†²å‡»ã€‚",priority:"é‡è¦ä¸”ç´§æ€¥",status:"è®¨è®ºä¸­",progress:0,owner:"Carol Li",participants:["Alice Chen","Eva Liu"],nextReview:"2026-02-12",createdAt:"2026-02-05",deadline:"2026-02-15",
    todos:[],
    notes:[{id:1,date:"2026-02-05",author:"Carol Li",content:"ç§‘æŠ€æ¿å—å æ¯”å·²è¾¾37%ï¼Œè¶…è¿‡35%é£æ§ä¸Šé™ã€‚éœ€è¦å°½å¿«å¤„ç†ã€‚",type:"normal"},{id:2,date:"2026-02-06",author:"Eva Liu",content:"å»ºè®®å¯¹æ¯”ä¸¤ä¸ªæ–¹æ¡ˆï¼šç›´æ¥å‡ä»“ vs ç”¨æœŸæƒå¯¹å†²ã€‚æœŸæƒæˆæœ¬çº¦0.8%ã€‚",type:"normal"}]},
  {id:4,topic:"Q2 å¤§ç±»èµ„äº§å†å¹³è¡¡è®¡åˆ’",conclusion:"",limitingFactor:"Q1æ•°æ®å°šæœªå‡ºå®Œï¼Œéœ€ç­‰å¾…2æœˆåº•å®è§‚æ•°æ®ç¡®è®¤æ–¹å‘ã€‚",priority:"ä¸é‡è¦ä½†ç´§æ€¥",status:"è®¨è®ºä¸­",progress:0,owner:"David Zhou",participants:["Bob Wang","Carol Li","Eva Liu"],nextReview:"2026-03-01",createdAt:"2026-02-01",deadline:"2026-04-01",
    todos:[{id:1,text:"å‡†å¤‡Q1å›é¡¾æŠ¥å‘Š",done:false}],
    notes:[{id:1,date:"2026-02-01",author:"David Zhou",content:"Q2å†å¹³è¡¡çª—å£åœ¨4æœˆåˆï¼Œæå‰ä¸€ä¸ªæœˆå¼€å§‹è®¨è®ºæ–¹å‘ã€‚åˆæ­¥æƒ³æ³•ï¼šå¢é…å•†å“ã€å‡é…æˆé•¿è‚¡ã€‚",type:"normal"}]}
];

let nid=100,tid=100,mid=10;
const Tag=({children,color,bg})=><span style={{display:"inline-flex",alignItems:"center",padding:"1px 8px",borderRadius:3,fontSize:11,fontWeight:600,color,background:bg,lineHeight:"20px",whiteSpace:"nowrap"}}>{children}</span>;
const Av=({name,size=22})=>{const c=["#597ef7","#d46b08","#36cfc9","#f759ab","#389e0d","#ffd666"];return<span title={name} style={{display:"inline-flex",alignItems:"center",justifyContent:"center",width:size,height:size,borderRadius:"50%",fontSize:size*0.4,fontWeight:700,color:"#fff",background:c[name.charCodeAt(0)%c.length],flexShrink:0}}>{name.split(" ").map(n=>n[0]).join("")}</span>};
const overdue=d=>d&&d<=TODAY;
const soon=d=>d&&(new Date(d)-new Date(TODAY))/864e5<=3&&d>=TODAY;
const daysLeft=d=>{if(!d)return null;return Math.ceil((new Date(d)-new Date(TODAY))/864e5)};

const PBar=({value,onChange,editable=true})=>{
  const v=Math.min(100,Math.max(0,value||0));
  return <div style={{display:"flex",alignItems:"center",gap:8,width:"100%"}}>
    <div style={{flex:1,height:8,borderRadius:4,background:"#e8e5e0",overflow:"hidden"}}>
      <div style={{height:"100%",borderRadius:4,background:v>=100?"#389e0d":v>0?"#52c41a":"transparent",width:v+"%",transition:"width 0.3s"}}/>
    </div>
    {editable?<input type="number" min="0" max="100" value={value||0} onChange={e=>onChange(Math.min(100,Math.max(0,parseInt(e.target.value)||0)))}
      style={{width:48,textAlign:"center",border:"1px solid #d9d6d0",borderRadius:4,padding:"2px 4px",fontSize:12,outline:"none",background:"#fff"}}/>
    :<span style={{fontSize:12,fontWeight:600,color:v>=100?"#389e0d":"#555",minWidth:36,textAlign:"right"}}>{v}%</span>}
  </div>
};

function App(){
  const[memos,setMemos]=useState(INIT);
  const[selId,setSelId]=useState(null);
  const[fS,setFS]=useState("all");
  const[fP,setFP]=useState("all");
  const[showNew,setShowNew]=useState(false);
  const[editMode,setEditMode]=useState(false);
  const[note,setNote]=useState("");
  const[nType,setNType]=useState("normal");
  const[todoT,setTodoT]=useState("");
  const[nm,setNm]=useState({topic:"",conclusion:"",limitingFactor:"",priority:PRIORITIES[0],owner:MEMBERS[0],participants:[],nextReview:"",deadline:"",progress:0});
  const sel=memos.find(m=>m.id===selId);
  const alerts=useMemo(()=>memos.filter(m=>m.status!=="å·²å®Œæˆ"&&(overdue(m.nextReview)||soon(m.nextReview))).sort((a,b)=>(a.nextReview||"9")>(b.nextReview||"9")?1:-1),[memos]);
  const list=useMemo(()=>memos.filter(m=>fS==="all"||m.status===fS).filter(m=>fP==="all"||m.priority===fP).sort((a,b)=>PRIORITIES.indexOf(a.priority)-PRIORITIES.indexOf(b.priority)||(b.createdAt>a.createdAt?1:-1)),[memos,fS,fP]);
  const upd=(id,u)=>setMemos(ms=>ms.map(m=>m.id===id?{...m,...u}:m));
  const del=(id)=>{if(!confirm("ç¡®å®šè¦åˆ é™¤è¿™æ¡ Discussion å—ï¼Ÿ"))return;setMemos(ms=>ms.filter(m=>m.id!==id));setSelId(null)};
  const addNote=()=>{if(!note.trim()||!sel)return;upd(sel.id,{notes:[...sel.notes,{id:++nid,date:TODAY,author:sel.owner,content:note.trim(),type:nType}]});setNote("");setNType("normal")};
  const addTodo=()=>{if(!todoT.trim()||!sel)return;upd(sel.id,{todos:[...sel.todos,{id:++tid,text:todoT.trim(),done:false}]});setTodoT("")};
  const togTodo=id=>sel&&upd(sel.id,{todos:sel.todos.map(t=>t.id===id?{...t,done:!t.done}:t)});
  const delTodo=id=>sel&&upd(sel.id,{todos:sel.todos.filter(t=>t.id!==id)});
  const delNote=id=>sel&&upd(sel.id,{notes:sel.notes.filter(n=>n.id!==id)});
  const create=()=>{if(!nm.topic.trim())return;const m={id:++mid,...nm,status:"è®¨è®ºä¸­",createdAt:TODAY,todos:[],notes:[]};setMemos([m,...memos]);setSelId(m.id);setShowNew(false);setNm({topic:"",conclusion:"",limitingFactor:"",priority:PRIORITIES[0],owner:MEMBERS[0],participants:[],nextReview:"",deadline:"",progress:0})};

  const I={border:"1px solid #d9d6d0",borderRadius:6,padding:"7px 10px",fontSize:13,outline:"none",width:"100%",boxSizing:"border-box",fontFamily:"inherit",background:"#fff"};
  const SL={...I,appearance:"auto"};
  const TA={...I,minHeight:48,resize:"vertical",lineHeight:1.5};
  const BP={background:"#1a1a1a",color:"#fff",border:"none",borderRadius:6,padding:"7px 16px",fontSize:13,fontWeight:500,cursor:"pointer"};
  const BG={background:"transparent",color:"#666",border:"1px solid #d9d6d0",borderRadius:6,padding:"7px 16px",fontSize:13,cursor:"pointer"};
  const BS={background:"transparent",color:"#888",border:"1px solid #e8e5e0",borderRadius:4,padding:"3px 10px",fontSize:11,cursor:"pointer"};
  const LB={fontSize:11,color:"#888",fontWeight:500,textTransform:"uppercase",letterSpacing:"0.5px",marginBottom:4,display:"block"};
  const NC={normal:{border:"#e8e5e0",label:""},decision:{border:"#597ef7",label:"å†³è®®",bg:"rgba(89,126,247,0.04)"},update:{border:"#d46b08",label:"æ›´æ–°",bg:"rgba(212,107,8,0.04)"},overturn:{border:"#cf1322",label:"æ¨ç¿»",bg:"rgba(207,19,34,0.04)"}};

  return(
    <div style={{background:"#fafaf9",minHeight:"100vh",display:"flex",flexDirection:"column"}}>
      <div style={{padding:"14px 24px",borderBottom:"1px solid #e8e5e0",background:"#fff",display:"flex",justifyContent:"space-between",alignItems:"center"}}>
        <div><h1 style={{fontSize:16,fontWeight:700,margin:0}}>Decision Discussion Tracker</h1><span style={{fontSize:12,color:"#999"}}>æŠ•èµ„å†³ç­–è®¨è®ºè¿½è¸ª</span></div>
        <div style={{display:"flex",gap:8,alignItems:"center"}}>
          {alerts.length>0&&<span style={{fontSize:12,color:"#cf1322",fontWeight:500}}>ğŸ”” {alerts.length} æ¡å¾…Review</span>}
          <button onClick={()=>{setShowNew(true);setSelId(null)}} style={BP}>+ æ–°å»º Discussion</button>
        </div>
      </div>

      <div style={{display:"flex",flex:1,overflow:"hidden"}}>
        {/* Sidebar */}
        <div style={{width:400,borderRight:"1px solid #e8e5e0",background:"#fff",display:"flex",flexDirection:"column",flexShrink:0}}>
          <div style={{padding:"10px 16px",borderBottom:"1px solid #f0ede8",display:"flex",gap:8,alignItems:"center"}}>
            <select value={fS} onChange={e=>setFS(e.target.value)} style={{...SL,fontSize:12,padding:"4px 8px",width:"auto"}}><option value="all">å…¨éƒ¨çŠ¶æ€</option>{STATUSES.map(s=><option key={s}>{s}</option>)}</select>
            <select value={fP} onChange={e=>setFP(e.target.value)} style={{...SL,fontSize:12,padding:"4px 8px",width:"auto"}}><option value="all">å…¨éƒ¨ä¼˜å…ˆåº¦</option>{PRIORITIES.map(p=><option key={p}>{p}</option>)}</select>
            <span style={{fontSize:11,color:"#aaa",marginLeft:"auto"}}>{list.length}</span>
          </div>
          {alerts.length>0&&<div style={{padding:"10px 16px",background:"rgba(207,19,34,0.03)",borderBottom:"1px solid #f0ede8"}}>
            <div style={{fontSize:11,fontWeight:600,color:"#cf1322",marginBottom:6}}>â° éœ€è¦ Review</div>
            {alerts.slice(0,3).map(m=><div key={m.id} onClick={()=>{setSelId(m.id);setShowNew(false)}} style={{fontSize:12,color:"#666",padding:"3px 0",cursor:"pointer",display:"flex",justifyContent:"space-between"}}>
              <span style={{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:250}}>{m.topic}</span>
              <span style={{color:overdue(m.nextReview)?"#cf1322":"#d46b08",fontSize:11,flexShrink:0,marginLeft:8}}>{overdue(m.nextReview)?"å·²è¿‡æœŸ":m.nextReview}</span>
            </div>)}
          </div>}
          <div style={{flex:1,overflow:"auto"}}>
            {list.map(m=>{const dl=daysLeft(m.deadline);return(
              <div key={m.id} onClick={()=>{setSelId(m.id);setShowNew(false)}}
                style={{padding:"14px 16px",borderBottom:"1px solid #f0ede8",cursor:"pointer",background:selId===m.id?"#f5f3ef":"transparent",transition:"background 0.1s"}}
                onMouseEnter={e=>{if(selId!==m.id)e.currentTarget.style.background="#faf8f5"}}
                onMouseLeave={e=>{if(selId!==m.id)e.currentTarget.style.background="transparent"}}>
                <div style={{display:"flex",gap:6,alignItems:"center",marginBottom:6}}>
                  <Tag color={PM[m.priority].c} bg={PM[m.priority].b}>{m.priority}</Tag>
                  <Tag color={SM[m.status].c} bg={SM[m.status].b}>{SM[m.status].i} {m.status}</Tag>
                  {(overdue(m.nextReview)||soon(m.nextReview))&&m.status!=="å·²å®Œæˆ"&&<span style={{fontSize:10,color:"#cf1322"}}>â°</span>}
                </div>
                <div style={{fontSize:14,fontWeight:600,color:"#1a1a1a",marginBottom:8,lineHeight:1.4}}>{m.topic}</div>
                <div style={{marginBottom:8}}><PBar value={m.progress} editable={false}/></div>
                <div style={{display:"flex",gap:12,alignItems:"center",fontSize:12,color:"#999"}}>
                  <span style={{display:"flex",alignItems:"center",gap:4}}><Av name={m.owner} size={16}/>{m.owner.split(" ")[0]}</span>
                  {m.deadline&&<span style={{color:dl!==null&&dl<0?"#cf1322":dl!==null&&dl<=7?"#d46b08":"#999"}}>{dl!==null&&dl<0?`é€¾æœŸ${Math.abs(dl)}å¤©`:dl!==null?`å‰©${dl}å¤©`:""}</span>}
                  <span>{m.notes.length} è®¨è®º</span>
                </div>
              </div>
            )})}
          </div>
        </div>

        {/* Main */}
        <div style={{flex:1,overflow:"auto",background:"#fafaf9"}}>
          {!sel&&!showNew&&<div style={{display:"flex",alignItems:"center",justifyContent:"center",height:"100%",color:"#ccc",fontSize:14}}>â† é€‰æ‹©ä¸€æ¡ Discussion</div>}

          {/* New */}
          {showNew&&<div style={{maxWidth:600,margin:"28px auto",padding:"0 24px"}}>
            <h2 style={{fontSize:18,fontWeight:700,marginBottom:20}}>æ–°å»º Decision Discussion</h2>
            <div style={{display:"flex",flexDirection:"column",gap:14}}>
              <div><label style={LB}>è®¨è®ºå†…å®¹</label><input value={nm.topic} onChange={e=>setNm({...nm,topic:e.target.value})} style={I} placeholder="è¿™ä¸ªå†³ç­–è¦è®¨è®ºä»€ä¹ˆï¼Ÿ" autoFocus/></div>
              <div><label style={LB}>ç»“è®ºï¼ˆå¯ç¨åå¡«å†™ï¼‰</label><textarea value={nm.conclusion} onChange={e=>setNm({...nm,conclusion:e.target.value})} style={TA} placeholder="è®¨è®ºåçš„ç»“è®º..."/></div>
              <div><label style={LB}>Limiting Factor</label><textarea value={nm.limitingFactor} onChange={e=>setNm({...nm,limitingFactor:e.target.value})} style={TA} placeholder="åˆ¶çº¦å› ç´ ã€ç“¶é¢ˆã€é£é™©..."/></div>
              <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12}}>
                <div><label style={LB}>ä¼˜å…ˆåº¦</label><select value={nm.priority} onChange={e=>setNm({...nm,priority:e.target.value})} style={{...SL,width:"100%"}}>{PRIORITIES.map(p=><option key={p}>{p}</option>)}</select></div>
                <div><label style={LB}>è´Ÿè´£äºº</label><select value={nm.owner} onChange={e=>setNm({...nm,owner:e.target.value})} style={{...SL,width:"100%"}}>{MEMBERS.map(m=><option key={m}>{m}</option>)}</select></div>
              </div>
              <div><label style={LB}>å‚ä¸äºº</label><div style={{display:"flex",gap:6,flexWrap:"wrap"}}>
                {MEMBERS.filter(m=>m!==nm.owner).map(m=>{const on=(nm.participants||[]).includes(m);return<button key={m} onClick={()=>setNm({...nm,participants:on?nm.participants.filter(p=>p!==m):[...(nm.participants||[]),m]})} style={{...BS,background:on?"#1a1a1a":"transparent",color:on?"#fff":"#888",borderColor:on?"#1a1a1a":"#e8e5e0"}}>{m}</button>})}
              </div></div>
              <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12}}>
                <div><label style={LB}>æˆªæ­¢æ—¥æœŸ</label><input type="date" value={nm.deadline||""} onChange={e=>setNm({...nm,deadline:e.target.value})} style={I}/></div>
                <div><label style={LB}>ä¸‹æ¬¡ Review</label><input type="date" value={nm.nextReview} onChange={e=>setNm({...nm,nextReview:e.target.value})} style={I}/></div>
              </div>
              <div style={{display:"flex",gap:8,justifyContent:"flex-end",marginTop:8}}>
                <button onClick={()=>setShowNew(false)} style={BG}>å–æ¶ˆ</button>
                <button onClick={create} style={BP}>åˆ›å»º</button>
              </div>
            </div>
          </div>}

          {/* Detail */}
          {sel&&!showNew&&<div style={{maxWidth:720,margin:"0 auto",padding:"28px 24px"}}>
            {/* Priority + Status + Actions */}
            <div style={{display:"flex",gap:6,alignItems:"center",marginBottom:10,justifyContent:"space-between"}}>
              <div style={{display:"flex",gap:6,alignItems:"center"}}>
                <select value={sel.priority} onChange={e=>upd(sel.id,{priority:e.target.value})} style={{border:"none",fontSize:11,fontWeight:600,color:PM[sel.priority].c,background:PM[sel.priority].b,borderRadius:3,padding:"2px 8px",cursor:"pointer",outline:"none"}}>{PRIORITIES.map(p=><option key={p}>{p}</option>)}</select>
                <select value={sel.status} onChange={e=>upd(sel.id,{status:e.target.value})} style={{border:"none",fontSize:11,fontWeight:600,color:SM[sel.status].c,background:SM[sel.status].b,borderRadius:3,padding:"2px 8px",cursor:"pointer",outline:"none"}}>{STATUSES.map(s=><option key={s}>{s}</option>)}</select>
              </div>
              <div style={{display:"flex",gap:6}}>
                <button onClick={()=>setEditMode(!editMode)} style={{...BS,color:editMode?"#1a1a1a":"#888",fontWeight:editMode?600:400}}>{editMode?"å®Œæˆç¼–è¾‘":"ç¼–è¾‘"}</button>
                <button onClick={()=>del(sel.id)} style={{...BS,color:"#cf1322",borderColor:"#ff7875"}}>åˆ é™¤</button>
              </div>
            </div>

            {/* 1. è®¨è®ºå†…å®¹ */}
            {editMode?
              <input value={sel.topic} onChange={e=>upd(sel.id,{topic:e.target.value})} style={{...I,fontSize:20,fontWeight:700,margin:"0 0 16px",lineHeight:1.4}} placeholder="è®¨è®ºå†…å®¹"/>
            :<h2 style={{fontSize:20,fontWeight:700,margin:"0 0 16px",lineHeight:1.4}}>{sel.topic}</h2>}

            {/* 2. ç»“è®º */}
            <div style={{background:sel.conclusion?"rgba(89,126,247,0.04)":"#fff",border:"1px solid "+(sel.conclusion?"#597ef7":"#e8e5e0"),borderRadius:8,padding:"12px 14px",marginBottom:10,borderLeftWidth:3,borderLeftStyle:"solid",borderLeftColor:sel.conclusion?"#597ef7":"#d9d6d0"}}>
              <div style={{fontSize:11,fontWeight:600,color:"#597ef7",textTransform:"uppercase",letterSpacing:"0.8px",marginBottom:4}}>ç»“è®º</div>
              <textarea value={sel.conclusion||""} onChange={e=>upd(sel.id,{conclusion:e.target.value})} placeholder="è®¨è®ºåå¡«å†™ç»“è®º..." style={{border:"none",background:"transparent",width:"100%",fontSize:13,color:"#333",lineHeight:1.6,resize:"none",outline:"none",minHeight:32,fontFamily:"inherit"}}/>
            </div>

            {/* 3. Limiting Factor */}
            <div style={{background:sel.limitingFactor?"rgba(207,19,34,0.03)":"#fff",border:"1px solid "+(sel.limitingFactor?"#ff7875":"#e8e5e0"),borderRadius:8,padding:"12px 14px",marginBottom:14,borderLeftWidth:3,borderLeftStyle:"solid",borderLeftColor:sel.limitingFactor?"#cf1322":"#d9d6d0"}}>
              <div style={{fontSize:11,fontWeight:600,color:"#cf1322",textTransform:"uppercase",letterSpacing:"0.8px",marginBottom:4}}>Limiting Factor</div>
              <textarea value={sel.limitingFactor||""} onChange={e=>upd(sel.id,{limitingFactor:e.target.value})} placeholder="åˆ¶çº¦å› ç´ ã€ç“¶é¢ˆ..." style={{border:"none",background:"transparent",width:"100%",fontSize:13,color:"#333",lineHeight:1.6,resize:"none",outline:"none",minHeight:32,fontFamily:"inherit"}}/>
            </div>

            {/* 4. æ—¶é—´è¡¨ */}
            <div style={{background:"#f6ffed",border:"1.5px solid #b7eb8f",borderRadius:10,padding:"16px 18px",marginBottom:24}}>
              <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12}}>
                <div style={{fontSize:13,fontWeight:700,color:"#389e0d"}}>ğŸ“… æ—¶é—´è¡¨</div>
                {(()=>{const dl=daysLeft(sel.deadline);if(dl===null)return null;return<span style={{fontSize:13,fontWeight:700,color:dl<0?"#cf1322":dl<=3?"#d46b08":dl<=7?"#fa8c16":"#389e0d"}}>{dl<0?`âš  å·²é€¾æœŸ ${Math.abs(dl)} å¤©`:dl===0?"âš¡ ä»Šå¤©æˆªæ­¢":`å‰©ä½™ ${dl} å¤©`}</span>})()}
              </div>
              <div style={{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:12,marginBottom:14}}>
                <div><div style={{fontSize:11,color:"#888",marginBottom:3}}>åˆ›å»ºæ—¥æœŸ</div><div style={{fontSize:13,fontWeight:600,color:"#555"}}>{sel.createdAt}</div></div>
                <div><div style={{fontSize:11,color:"#888",marginBottom:3}}>æˆªæ­¢æ—¥æœŸ</div><input type="date" value={sel.deadline||""} onChange={e=>upd(sel.id,{deadline:e.target.value})} style={{border:"1px solid #b7eb8f",borderRadius:4,padding:"3px 6px",fontSize:13,fontWeight:600,color:"#333",background:"#fff",outline:"none",fontFamily:"inherit"}}/></div>
                <div><div style={{fontSize:11,color:"#888",marginBottom:3}}>ä¸‹æ¬¡ Review</div><input type="date" value={sel.nextReview||""} onChange={e=>upd(sel.id,{nextReview:e.target.value})} style={{border:"1px solid "+(overdue(sel.nextReview)?"#ff7875":"#b7eb8f"),borderRadius:4,padding:"3px 6px",fontSize:13,fontWeight:600,color:overdue(sel.nextReview)?"#cf1322":"#333",background:overdue(sel.nextReview)?"#fff1f0":"#fff",outline:"none",fontFamily:"inherit"}}/>{overdue(sel.nextReview)&&<div style={{fontSize:10,color:"#cf1322",fontWeight:600,marginTop:2}}>å·²è¿‡æœŸ!</div>}</div>
              </div>
              <div style={{display:"flex",alignItems:"center",gap:10}}>
                <span style={{fontSize:12,fontWeight:600,color:"#389e0d",flexShrink:0}}>è¿›åº¦</span>
                <PBar value={sel.progress} onChange={v=>upd(sel.id,{progress:v})}/>
              </div>
            </div>

            {/* Meta */}
            <div style={{display:"flex",gap:16,flexWrap:"wrap",fontSize:13,color:"#888",marginBottom:24,paddingBottom:16,borderBottom:"1px solid #f0ede8"}}>
              <span style={{display:"flex",alignItems:"center",gap:5}}><span style={{color:"#bbb",fontSize:11}}>è´Ÿè´£äºº</span><Av name={sel.owner} size={18}/><span style={{color:"#555"}}>{sel.owner}</span></span>
              {sel.participants.length>0&&<span style={{display:"flex",alignItems:"center",gap:4}}><span style={{color:"#bbb",fontSize:11}}>å‚ä¸</span>{sel.participants.map(p=><Av key={p} name={p} size={18}/>)}</span>}
            </div>

            {/* Todos */}
            <div style={{marginBottom:28}}>
              <h3 style={{fontSize:12,fontWeight:600,color:"#aaa",textTransform:"uppercase",letterSpacing:"0.8px",marginBottom:10}}>æ‰§è¡Œæ¸…å• {sel.todos.length>0&&`(${sel.todos.filter(t=>t.done).length}/${sel.todos.length})`}</h3>
              {sel.todos.map(t=><div key={t.id} style={{display:"flex",gap:8,alignItems:"center",padding:"6px 0",fontSize:13}}>
                <span onClick={()=>togTodo(t.id)} style={{width:16,height:16,borderRadius:3,display:"flex",alignItems:"center",justifyContent:"center",border:t.done?"none":"1.5px solid #d0cdc7",background:t.done?"#1a1a1a":"transparent",color:"#fff",fontSize:10,flexShrink:0,cursor:"pointer"}}>{t.done&&"âœ“"}</span>
                <span onClick={()=>togTodo(t.id)} style={{color:t.done?"#bbb":"#333",textDecoration:t.done?"line-through":"none",flex:1,cursor:"pointer"}}>{t.text}</span>
                <button onClick={()=>delTodo(t.id)} style={{...BS,padding:"2px 6px",fontSize:10,color:"#cf1322",borderColor:"#ff7875",opacity:0.6}}>åˆ é™¤</button>
              </div>)}
              <div style={{display:"flex",gap:6,marginTop:8}}>
                <input value={todoT} onChange={e=>setTodoT(e.target.value)} onKeyDown={e=>e.key==="Enter"&&addTodo()} placeholder="æ·»åŠ æ‰§è¡Œäº‹é¡¹..." style={{...I,flex:1,fontSize:12}}/>
                <button onClick={addTodo} style={BS}>æ·»åŠ </button>
              </div>
            </div>

            {/* Timeline */}
            <div>
              <h3 style={{fontSize:12,fontWeight:600,color:"#aaa",textTransform:"uppercase",letterSpacing:"0.8px",marginBottom:14}}>è®¨è®ºæ—¶é—´çº¿ ({sel.notes.length})</h3>
              <div style={{position:"relative",paddingLeft:20}}>
                <div style={{position:"absolute",left:5,top:8,bottom:0,width:1,background:"#e8e5e0"}}/>
                {sel.notes.map(n=>{const nc=NC[n.type]||NC.normal;const dot=n.type==="decision"?"#597ef7":n.type==="overturn"?"#cf1322":n.type==="update"?"#d46b08":"#d0cdc7";return(
                  <div key={n.id} style={{position:"relative",marginBottom:16}}>
                    <div style={{position:"absolute",left:-19,top:8,width:9,height:9,borderRadius:"50%",background:dot,border:"2px solid #fafaf9"}}/>
                    <div style={{background:nc.bg||"#fff",border:`1px solid ${nc.border}`,borderRadius:8,padding:"12px 14px",borderLeftWidth:n.type!=="normal"?3:1,borderLeftStyle:"solid"}}>
                      <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:6}}>
                        <div style={{display:"flex",alignItems:"center",gap:6}}><Av name={n.author} size={18}/><span style={{fontSize:12,fontWeight:600,color:"#555"}}>{n.author}</span>{nc.label&&<Tag color={nc.border} bg={nc.bg||"transparent"}>{nc.label}</Tag>}</div>
                        <div style={{display:"flex",alignItems:"center",gap:6}}>
                          <span style={{fontSize:11,color:"#bbb"}}>{n.date}</span>
                          <button onClick={()=>delNote(n.id)} style={{...BS,padding:"1px 5px",fontSize:9,color:"#cf1322",borderColor:"#ff7875",opacity:0.5}}>åˆ é™¤</button>
                        </div>
                      </div>
                      <div style={{fontSize:13,color:"#333",lineHeight:1.65,whiteSpace:"pre-wrap"}}>{n.content}</div>
                    </div>
                  </div>
                )})}
              </div>
              <div style={{marginTop:16,paddingLeft:20}}>
                <div style={{display:"flex",gap:6,marginBottom:8}}>
                  {[{k:"normal",l:"è®¨è®º"},{k:"decision",l:"ğŸ“Œ å†³è®®"},{k:"update",l:"ğŸ”„ æ›´æ–°"},{k:"overturn",l:"âš ï¸ æ¨ç¿»"}].map(t=><button key={t.k} onClick={()=>setNType(t.k)} style={{...BS,fontSize:12,background:nType===t.k?"#1a1a1a":"transparent",color:nType===t.k?"#fff":"#888",borderColor:nType===t.k?"#1a1a1a":"#e8e5e0"}}>{t.l}</button>)}
                </div>
                <textarea value={note} onChange={e=>setNote(e.target.value)} placeholder={nType==="decision"?"è®°å½•å›¢é˜Ÿæœ€ç»ˆå†³è®®...":nType==="overturn"?"è¯´æ˜æ¨ç¿»ä¹‹å‰ç»“è®ºçš„åŸå› ...":nType==="update"?"æ›´æ–°æœ€æ–°è¿›å±•...":"æ·»åŠ è®¨è®ºå†…å®¹..."} onKeyDown={e=>{if(e.key==="Enter"&&e.metaKey)addNote()}} style={{...I,minHeight:64,resize:"vertical",lineHeight:1.6}}/>
                <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginTop:8}}>
                  <span style={{fontSize:11,color:"#ccc"}}>âŒ˜+Enter å‘é€</span>
                  <button onClick={addNote} style={BP}>æ·»åŠ ç¬”è®°</button>
                </div>
              </div>
            </div>
          </div>}
        </div>
      </div>
    </div>
  );
}
ReactDOM.render(<App/>,document.getElementById("root"));
</script>
</body>
</html>
